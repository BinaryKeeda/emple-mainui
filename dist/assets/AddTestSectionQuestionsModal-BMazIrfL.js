import{r as C,j as e,ab as D,_,d as $,B as L}from"./index-Cw-TTt2Q.js";import{r as H,u as P}from"./xlsx-CygJKsBP.js";import{B as j}from"./Box-C7dh2Txy.js";import{T as y}from"./Typography-D7TLC_C2.js";import{B as m}from"./Button-Bd-jOGO2.js";import{U as g}from"./Upload-DNBAjMPA.js";import{T as c}from"./TextField-M4TmMMzK.js";import{M as w}from"./MenuItem-D82BoYbg.js";import{R as Y}from"./Radio-Bd_vX7MC.js";import{C as G}from"./Checkbox-BBkCMwL0.js";import"./extendSxProp-C6ZwBt7c.js";import"./index-B5DdrQpV.js";import"./Select-gCma7GWS.js";import"./Menu-BUiVb5Mu.js";import"./index-BQr0Oul9.js";import"./Grow-BjMe797Z.js";import"./Paper-DEUqRhru.js";import"./mergeSlotProps-CIWjKpOs.js";import"./dividerClasses-CSjf0cod.js";import"./SwitchBase-DmBbHHNN.js";const K={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:900,maxHeight:"90vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function V({onSubmit:b}){const[t,r]=C.useState({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),[d,p]=C.useState(!1),v=(a,s)=>{const o=[...t.options];o[a]={...o[a],text:s},r({...t,options:o})},u=a=>{const s=t.options.map((o,n)=>({...o,isCorrect:n===a}));r({...t,options:s})},x=a=>{const s=[...t.options];s[a].isCorrect=!s[a].isCorrect,r({...t,options:s})},h=async()=>{try{p(!0),await b([t]),r({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})})}catch(a){console.error(a)}finally{p(!1)}};return e.jsxs(j,{className:"space-y-4",children:[e.jsx(c,{size:"small",label:"Question Text",fullWidth:!0,multiline:!0,value:t.question,onChange:a=>r({...t,question:a.target.value})}),e.jsx(c,{size:"small",label:"Topic",fullWidth:!0,value:t.topic,onChange:a=>r({...t,topic:a.target.value})}),e.jsx(c,{size:"small",label:"Marks",type:"number",value:t.marks,onChange:a=>r({...t,marks:parseFloat(a.target.value)})}),e.jsx(c,{size:"small",label:"Negative Marks",type:"number",value:t.negative,onChange:a=>r({...t,negative:parseFloat(a.target.value)})}),e.jsxs(c,{size:"small",select:!0,label:"Category",fullWidth:!0,value:t.category,onChange:a=>{const s=a.target.value,o=Array(4).fill({text:"",isCorrect:!1});r({...t,category:s,options:o,answer:""})},children:[e.jsx(w,{value:"MCQ",children:"MCQ"}),e.jsx(w,{value:"MSQ",children:"MSQ"}),e.jsx(w,{value:"Text",children:"Text"})]}),t.category==="Text"&&e.jsx(c,{size:"small",label:"Answer",fullWidth:!0,value:t.answer,onChange:a=>r({...t,answer:a.target.value})}),(t.category==="MCQ"||t.category==="MSQ")&&e.jsxs(j,{children:[e.jsx(y,{sx:{my:1},className:"mb-5 font-medium",children:"Options (4 required):"}),t.options.map((a,s)=>e.jsxs(j,{className:"flex items-center gap-2 mb-2",children:[t.category==="MCQ"?e.jsx(Y,{size:"small",checked:a.isCorrect,onChange:()=>u(s)}):e.jsx(G,{size:"small",checked:a.isCorrect,onChange:()=>x(s)}),e.jsx(c,{size:"small",fullWidth:!0,label:`Option ${s+1}`,value:a.text,onChange:o=>v(s,o.target.value)})]},s))]}),e.jsx(m,{variant:"contained",onClick:h,disabled:d,children:d?"Submitting...":"Add Question"})]})}function Ce({open:b,onClose:t,onSuccess:r,testId:d,sectionId:p}){const[v,u]=C.useState(!1),[x,h]=C.useState(null),a=async n=>{const l=n.target.files[0];if(l)try{u(!0);const i=await l.text(),f=JSON.parse(i);await o(f)}catch(i){console.error(i),h("Invalid JSON format")}finally{u(!1)}},s=async n=>{const l=n.target.files[0];if(l)try{u(!0);const i=await l.arrayBuffer(),f=H(i,{type:"array"}),T=f.Sheets[f.SheetNames[0]],z=P.sheet_to_json(T).map(q=>{const{question:E,category:O,marks:A,negative:U,topic:B,answer:F,option1:I,correct1:M,option2:W,correct2:Q,option3:J,correct3:N,option4:R,correct4:k}=q,S={question:E||"",category:O||"MCQ",marks:parseFloat(A)||1,negative:parseFloat(U)||0,topic:B||""};return S.category==="Text"?{...S,answer:F||""}:{...S,options:[{text:I||"",isCorrect:M===!0||M==="true"},{text:W||"",isCorrect:Q===!0||Q==="true"},{text:J||"",isCorrect:N===!0||N==="true"},{text:R||"",isCorrect:k===!0||k==="true"}]}});await o(z)}catch(i){console.error(i),h("Invalid Excel format")}finally{u(!1)}},o=async n=>{try{await $.post(`${L}/api/admin/tests/${d}/sections/${p}/questions`,n,{withCredentials:!0}),alert("Questions added successfully!"),t(),r()}catch(l){console.error(l),alert("Failed to submit questions")}};return e.jsx(D,{open:b,onClose:t,children:e.jsxs(j,{sx:K,children:[e.jsx(y,{variant:"h6",className:"mb-4",children:"Add Questions to Section"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs(m,{variant:"outlined",component:"label",startIcon:e.jsx(g,{fontSize:"small"}),children:["Upload JSON",e.jsx("input",{type:"file",accept:".json",hidden:!0,onChange:a})]}),e.jsxs(m,{variant:"outlined",component:"label",startIcon:e.jsx(g,{fontSize:"small"}),children:["Upload Excel",e.jsx("input",{type:"file",accept:".xlsx,.xls",hidden:!0,onChange:s})]})]}),x&&e.jsx(y,{color:"error",variant:"body2",className:"mb-2",children:x}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx(m,{variant:"outlined",href:"/data/sample-json.json",download:!0,startIcon:e.jsx(g,{fontSize:"small"}),children:"Download JSON Template"}),e.jsx(m,{variant:"outlined",href:"/data/sample-excel.xlsx",download:!0,startIcon:e.jsx(g,{fontSize:"small"}),children:"Download Excel Template"})]}),e.jsx(y,{variant:"subtitle1",className:"mb-2 font-semibold",children:"Manual Entry"}),e.jsx(V,{onSubmit:o}),v&&e.jsx(_,{className:"mt-4"})]})})}export{Ce as default};

import{r as j,af as oe,ag as ie,ah as ce,a1 as le,j as e,a3 as ue,a5 as de,ai as me,ch as B,ci as R,ab as pe,_ as J,d as q,B as H,i as xe}from"./index-CwFirUwE.js";import{E as Z}from"./ExpandMore-DVj4DPDD.js";import{r as fe,u as he}from"./xlsx-CygJKsBP.js";import{B as C}from"./Box-BtSkbTt1.js";import{T as b}from"./Typography-CC-3_RnQ.js";import{B as k}from"./Button-CwBV4LsW.js";import{U as z}from"./Upload-dQFC9AA_.js";import{A as K,a as Y,b as X}from"./AccordionSummary-B09CvqWn.js";import{T as w}from"./TextField-DMpPckEq.js";import{M as O}from"./MenuItem-DD1dV7FL.js";import{R as ge}from"./Radio-BhdNZwwo.js";import{C as je}from"./Checkbox-C_V6AvLB.js";import{e as be}from"./extendSxProp-DFlBq1nu.js";import{C as ve}from"./Chip-lwFTdxrC.js";import{P as V}from"./Paper-BstRyx-0.js";import"./index-BPelpG7E.js";import"./Grow-C3caBiZd.js";import"./Select-Dpocm-iB.js";import"./Menu-E5Cf6WUU.js";import"./index-lq-zVssx.js";import"./mergeSlotProps-DHprRM8w.js";import"./dividerClasses-iHSsxWpg.js";import"./SwitchBase-Bvi7Q-Qw.js";const _=j.createContext();function ye(t){return oe("MuiGrid",t)}const Ce=[0,1,2,3,4,5,6,7,8,9,10],we=["column-reverse","column","row-reverse","row"],Se=["nowrap","wrap-reverse","wrap"],M=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Q=ie("MuiGrid",["root","container","item","zeroMinWidth",...Ce.map(t=>`spacing-xs-${t}`),...we.map(t=>`direction-xs-${t}`),...Se.map(t=>`wrap-xs-${t}`),...M.map(t=>`grid-xs-${t}`),...M.map(t=>`grid-sm-${t}`),...M.map(t=>`grid-md-${t}`),...M.map(t=>`grid-lg-${t}`),...M.map(t=>`grid-xl-${t}`)]);function ke({theme:t,ownerState:s}){let n;return t.breakpoints.keys.reduce((o,a)=>{let c={};if(s[a]&&(n=s[a]),!n)return o;if(n===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(n==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const l=B({values:s.columns,breakpoints:t.breakpoints.values}),p=typeof l=="object"?l[a]:l;if(p==null)return o;const f=`${Math.round(n/p*1e8)/1e6}%`;let r={};if(s.container&&s.item&&s.columnSpacing!==0){const i=t.spacing(s.columnSpacing);if(i!=="0px"){const d=`calc(${f} + ${i})`;r={flexBasis:d,maxWidth:d}}}c={flexBasis:f,flexGrow:0,maxWidth:f,...r}}return t.breakpoints.values[a]===0?Object.assign(o,c):o[t.breakpoints.up(a)]=c,o},{})}function Ne({theme:t,ownerState:s}){const n=B({values:s.direction,breakpoints:t.breakpoints.values});return R({theme:t},n,o=>{const a={flexDirection:o};return o.startsWith("column")&&(a[`& > .${Q.item}`]={maxWidth:"none"}),a})}function ee({breakpoints:t,values:s}){let n="";Object.keys(s).forEach(a=>{n===""&&s[a]!==0&&(n=a)});const o=Object.keys(t).sort((a,c)=>t[a]-t[c]);return o.slice(0,o.indexOf(n))}function Me({theme:t,ownerState:s}){const{container:n,rowSpacing:o}=s;let a={};if(n&&o!==0){const c=B({values:o,breakpoints:t.breakpoints.values});let l;typeof c=="object"&&(l=ee({breakpoints:t.breakpoints.values,values:c})),a=R({theme:t},c,(p,f)=>{const r=t.spacing(p);return r!=="0px"?{marginTop:`calc(-1 * ${r})`,[`& > .${Q.item}`]:{paddingTop:r}}:l!=null&&l.includes(f)?{}:{marginTop:0,[`& > .${Q.item}`]:{paddingTop:0}}})}return a}function $e({theme:t,ownerState:s}){const{container:n,columnSpacing:o}=s;let a={};if(n&&o!==0){const c=B({values:o,breakpoints:t.breakpoints.values});let l;typeof c=="object"&&(l=ee({breakpoints:t.breakpoints.values,values:c})),a=R({theme:t},c,(p,f)=>{const r=t.spacing(p);if(r!=="0px"){const i=`calc(-1 * ${r})`;return{width:`calc(100% + ${r})`,marginLeft:i,[`& > .${Q.item}`]:{paddingLeft:r}}}return l!=null&&l.includes(f)?{}:{width:"100%",marginLeft:0,[`& > .${Q.item}`]:{paddingLeft:0}}})}return a}function Qe(t,s,n={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[n[`spacing-xs-${String(t)}`]];const o=[];return s.forEach(a=>{const c=t[a];Number(c)>0&&o.push(n[`spacing-${a}-${String(c)}`])}),o}const We=ue("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t,{container:o,direction:a,item:c,spacing:l,wrap:p,zeroMinWidth:f,breakpoints:r}=n;let i=[];o&&(i=Qe(l,r,s));const d=[];return r.forEach(h=>{const v=n[h];v&&d.push(s[`grid-${h}-${String(v)}`])}),[s.root,o&&s.container,c&&s.item,f&&s.zeroMinWidth,...i,a!=="row"&&s[`direction-xs-${String(a)}`],p!=="wrap"&&s[`wrap-xs-${String(p)}`],...d]}})(({ownerState:t})=>({boxSizing:"border-box",...t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},...t.item&&{margin:0},...t.zeroMinWidth&&{minWidth:0},...t.wrap!=="wrap"&&{flexWrap:t.wrap}}),Ne,Me,$e,ke);function Te(t,s){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const n=[];return s.forEach(o=>{const a=t[o];if(Number(a)>0){const c=`spacing-${o}-${String(a)}`;n.push(c)}}),n}const Ee=t=>{const{classes:s,container:n,direction:o,item:a,spacing:c,wrap:l,zeroMinWidth:p,breakpoints:f}=t;let r=[];n&&(r=Te(c,f));const i=[];f.forEach(h=>{const v=t[h];v&&i.push(`grid-${h}-${String(v)}`)});const d={root:["root",n&&"container",a&&"item",p&&"zeroMinWidth",...r,o!=="row"&&`direction-xs-${String(o)}`,l!=="wrap"&&`wrap-xs-${String(l)}`,...i]};return me(d,ye,s)},$=j.forwardRef(function(s,n){const o=ce({props:s,name:"MuiGrid"}),{breakpoints:a}=le(),c=be(o),{className:l,columns:p,columnSpacing:f,component:r="div",container:i=!1,direction:d="row",item:h=!1,rowSpacing:v,spacing:x=0,wrap:u="wrap",zeroMinWidth:m=!1,...g}=c,y=v||x,N=f||x,I=j.useContext(_),W=i?p||12:I,T={},E={...g};a.keys.forEach(S=>{g[S]!=null&&(T[S]=g[S],delete E[S])});const A={...c,columns:W,container:i,direction:d,item:h,rowSpacing:y,columnSpacing:N,wrap:u,zeroMinWidth:m,spacing:x,...T,breakpoints:a.keys},P=Ee(A);return e.jsx(_.Provider,{value:W,children:e.jsx(We,{ownerState:A,className:de(P.root,l),as:r,ref:n,...E})})}),Ae={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"95%",maxWidth:900,maxHeight:"90vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function ze({onSubmit:t}){const[s,n]=j.useState({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})}),[o,a]=j.useState(!1),c=(r,i)=>{const d=[...s.options];d[r]={...d[r],text:i},n({...s,options:d})},l=r=>{const i=s.options.map((d,h)=>({...d,isCorrect:h===r}));n({...s,options:i})},p=r=>{const i=[...s.options];i[r].isCorrect=!i[r].isCorrect,n({...s,options:i})},f=async()=>{try{a(!0),await t([s]),n({question:"",marks:1,negative:0,topic:"",category:"MCQ",answer:"",options:Array(4).fill({text:"",isCorrect:!1})})}catch(r){console.error(r)}finally{a(!1)}};return e.jsxs(C,{className:"space-y-4",children:[e.jsx(w,{size:"small",label:"Question Text",fullWidth:!0,multiline:!0,value:s.question,onChange:r=>n({...s,question:r.target.value})}),e.jsx(w,{size:"small",label:"Topic",fullWidth:!0,value:s.topic,onChange:r=>n({...s,topic:r.target.value})}),e.jsx(w,{size:"small",label:"Marks",type:"number",value:s.marks,onChange:r=>n({...s,marks:parseFloat(r.target.value)})}),e.jsx(w,{size:"small",label:"Negative Marks",type:"number",value:s.negative,onChange:r=>n({...s,negative:parseFloat(r.target.value)})}),e.jsxs(w,{size:"small",select:!0,label:"Category",fullWidth:!0,value:s.category,onChange:r=>{const i=r.target.value,d=Array(4).fill({text:"",isCorrect:!1});n({...s,category:i,options:d,answer:""})},children:[e.jsx(O,{value:"MCQ",children:"MCQ"}),e.jsx(O,{value:"MSQ",children:"MSQ"}),e.jsx(O,{value:"Text",children:"Text"})]}),s.category==="Text"&&e.jsx(w,{size:"small",label:"Answer",fullWidth:!0,value:s.answer,onChange:r=>n({...s,answer:r.target.value})}),(s.category==="MCQ"||s.category==="MSQ")&&e.jsxs(C,{children:[e.jsx(b,{sx:{my:1},className:"mb-5 font-medium",children:"Options (4 required):"}),s.options.map((r,i)=>e.jsxs(C,{className:"flex items-center gap-2 mb-2",children:[s.category==="MCQ"?e.jsx(ge,{size:"small",checked:r.isCorrect,onChange:()=>l(i)}):e.jsx(je,{size:"small",checked:r.isCorrect,onChange:()=>p(i)}),e.jsx(w,{size:"small",fullWidth:!0,label:`Option ${i+1}`,value:r.text,onChange:d=>c(i,d.target.value)})]},i))]}),e.jsx(k,{variant:"contained",onClick:f,disabled:o,children:o?"Submitting...":"Add Question"})]})}function Be({open:t,onClose:s,onSuccess:n,bankId:o,sectionId:a}){const[c,l]=j.useState(!1),[p,f]=j.useState(null),[r,i]=j.useState([]),d=async x=>{const u=x.target.files[0];if(u)try{l(!0);const m=await u.text(),g=JSON.parse(m);i(g)}catch(m){console.error(m),f("Invalid JSON format")}finally{l(!1)}},h=async x=>{const u=x.target.files[0];if(u)try{l(!0);const m=await u.arrayBuffer(),g=fe(m,{type:"array"}),y=g.Sheets[g.SheetNames[0]],I=he.sheet_to_json(y).map(W=>{const{question:T,category:E,marks:A,negative:P,topic:S,answer:te,option1:se,correct1:U,option2:re,correct2:D,option3:ne,correct3:L,option4:ae,correct4:F}=W,G={question:T||"",category:E||"MCQ",marks:parseFloat(A)||1,negative:parseFloat(P)||0,topic:S||""};return G.category==="Text"?{...G,answer:te||""}:{...G,options:[{text:se||"",isCorrect:U===!0||U==="true"},{text:re||"",isCorrect:D===!0||D==="true"},{text:ne||"",isCorrect:L===!0||L==="true"},{text:ae||"",isCorrect:F===!0||F==="true"}]}});i(I)}catch(m){console.error(m),f("Invalid Excel format")}finally{l(!1)}},v=async x=>{try{await q.post(`${H}/api/admin/add/questionbanks/questions/${o}/`,x,{withCredentials:!0}),alert("Questions added successfully!"),s(),n()}catch(u){console.error(u),alert("Failed to submit questions")}};return e.jsx(pe,{open:!0,onClose:s,children:e.jsxs(C,{sx:Ae,children:[e.jsx(b,{variant:"h6",className:"mb-4",children:"Add Questions to Section"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs(k,{variant:"outlined",component:"label",startIcon:e.jsx(z,{fontSize:"small"}),children:["Upload JSON",e.jsx("input",{type:"file",accept:".json",hidden:!0,onChange:d})]}),e.jsxs(k,{variant:"outlined",component:"label",startIcon:e.jsx(z,{fontSize:"small"}),children:["Upload Excel",e.jsx("input",{type:"file",accept:".xlsx,.xls",hidden:!0,onChange:h})]})]}),p&&e.jsx(b,{color:"error",variant:"body2",className:"mb-2",children:p}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx(k,{variant:"outlined",href:"/data/sample-json.json",download:!0,startIcon:e.jsx(z,{fontSize:"small"}),children:"Download JSON Template"}),e.jsx(k,{variant:"outlined",href:"/data/sample-excel.xlsx",download:!0,startIcon:e.jsx(z,{fontSize:"small"}),children:"Download Excel Template"})]}),e.jsx(b,{variant:"subtitle1",className:"mb-2 font-semibold",children:"Manual Entry"}),e.jsx(ze,{onSubmit:v}),r.length>0&&e.jsxs(C,{className:"mt-6",children:[e.jsxs(b,{variant:"subtitle1",className:"mb-2 font-semibold",children:["Preview Uploaded Questions (",r.length,")"]}),r.map((x,u)=>{var m;return e.jsxs(K,{defaultExpanded:u===0,children:[e.jsx(Y,{expandIcon:e.jsx(Z,{}),children:e.jsxs(b,{children:["Q",u+1,": ",x.question.slice(0,80),"..."]})}),e.jsxs(X,{children:[e.jsxs(b,{children:[e.jsx("strong",{children:"Topic:"})," ",x.topic]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Marks:"})," ",x.marks]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Negative:"})," ",x.negative]}),e.jsxs(b,{children:[e.jsx("strong",{children:"Category:"})," ",x.category]}),x.category==="Text"&&e.jsxs(b,{children:[e.jsx("strong",{children:"Answer:"})," ",x.answer]}),(x.category==="MCQ"||x.category==="MSQ")&&e.jsx(C,{className:"mt-2 space-y-1",children:(m=x.options)==null?void 0:m.map((g,y)=>e.jsxs(b,{children:[g.isCorrect?"✅":"⬜️"," Option ",y+1,": ",g.text]},y))})]})]},u)}),e.jsx(k,{className:"mt-4",variant:"contained",onClick:()=>v(r),children:"Submit All Previewed Questions"})]}),c&&e.jsx(J,{className:"mt-4"})]})})}function ot(){const[t,s]=j.useState([]),[n,o]=j.useState(1),[a,c]=j.useState(!0),[l,p]=j.useState(!1),[f,r]=j.useState(!1),i=j.useRef(),{id:d}=xe(),[h,v]=j.useState(null),x=j.useCallback(u=>{l||(i.current&&i.current.disconnect(),i.current=new IntersectionObserver(m=>{m[0].isIntersecting&&a&&o(g=>g+1)}),u&&i.current.observe(u))},[l,a]);return j.useEffect(()=>{(async()=>{p(!0);try{const m=await q.get(`${H}/api/admin/get/questionbank/questions/${d}?page=${n}&limit=10`,{withCredentials:!0});s(g=>[...g,...m.data.questions]),c(m.data.hasMore),v(m.data.bankDetails)}catch(m){console.error(m)}finally{p(!1)}})()},[n,d]),e.jsxs("div",{maxWidth:"md",mx:"auto",px:2,py:4,children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md mb-10 mx-auto",children:[f&&e.jsx(Be,{onClose:()=>r(!1),bankId:d}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Edit Question Bank"}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Bank Name:"})," ",(h==null?void 0:h.name)||"N/A"]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Bank Category:"})," ",(h==null?void 0:h.category)||"N/A"]})]}),e.jsxs("button",{onClick:()=>r(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition duration-150",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Question"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:t.map((u,m)=>{var g;return e.jsxs(K,{ref:m===t.length-1?x:null,children:[e.jsx(Y,{expandIcon:e.jsx(Z,{}),children:e.jsxs($,{container:!0,spacing:2,alignItems:"center",children:[e.jsx($,{item:!0,xs:9,children:e.jsx(b,{fontWeight:600,children:u.question||u.title||"Untitled Question"})}),e.jsx($,{item:!0,xs:3,children:e.jsx(ve,{label:u.category,color:"primary",variant:"outlined",size:"small",sx:{textTransform:"uppercase"}})})]})}),e.jsxs(X,{children:[u.category==="MCQ"&&e.jsx($,{container:!0,spacing:1,children:(g=u.options)==null?void 0:g.map((y,N)=>e.jsx($,{item:!0,xs:12,sm:6,children:e.jsxs(V,{elevation:1,sx:{padding:1,backgroundColor:y.isCorrect?"#d1fae5":"#f3f4f6",border:y.isCorrect?"1px solid #10b981":"1px solid #d1d5db",color:y.isCorrect?"#065f46":"#374151"},children:[String.fromCharCode(65+N),". ",y.text]})},y._id||N))}),u.category==="Text"&&e.jsxs(C,{mt:2,children:[e.jsx(b,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Answer:"}),e.jsx(V,{variant:"outlined",sx:{padding:1,backgroundColor:"#f9fafb"},children:e.jsx(b,{children:u.answer||"Not Provided"})})]})]})]},u._id||m)})}),l&&e.jsx(C,{display:"flex",justifyContent:"center",mt:3,children:e.jsx(J,{size:24})}),!a&&!l&&e.jsx(b,{textAlign:"center",mt:3,color:"text.secondary",children:"No more questions."})]})}export{ot as default};

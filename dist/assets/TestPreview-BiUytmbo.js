import{e as I,j as e,r as v,i as E,I as M,ae as _,d as L,B as O}from"./index-DgAd_cHG.js";const P=I(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos"),$=(w,S)=>{let n=0,p=0,g=0,C=[];return w.forEach(d=>{var j,f;const o=S.sections.find(s=>s._id===d.sectionId);let b=0,x=0,u=0,h=0,l=0,k=0;if(d.sectionType==="Quiz"){const s=(o==null?void 0:o.questionSet)||[];(j=d.quizAnswers)==null||j.forEach(i=>{Object.entries(i).forEach(([a,t])=>{var y;const r=s.find(m=>m._id===a);if(!r)return;b+=r.marks,n+=r.marks;let N=!1;if(r.category==="Text")N=((y=r.answer)==null?void 0:y.trim().toLowerCase())===(t==null?void 0:t.trim().toLowerCase());else{const m=r.options.find(T=>T.isCorrect);N=(m==null?void 0:m.text)===t}N?(x+=r.marks,p+=r.marks,h++):t?(l++,r.negative&&(u+=r.negative,g+=r.negative)):k++})})}d.sectionType==="Coding"&&((f=d.codingAnswers)==null||f.forEach(s=>{const i=Object.keys(s)[0],a=s[i],t=a.totalTestCases||0,r=a.passedTestCases||0;b+=t,x+=r,n+=t,p+=r})),C.push({sectionName:(o==null?void 0:o.name)||"Untitled Section",sectionType:d.sectionType,totalMarks:b,obtainedMarks:x,negativeMarks:u,correctCount:h,wrongCount:l,skippedCount:k})}),{totalMarks:n,obtainedMarks:p,negativeMarks:g,cumulativeMarks:p-g,sectionAnalysis:C,verdict:p-g>=n*.4?"Pass":"Fail"}},D=()=>{var f;const[w,S]=v.useState(null),[n,p]=v.useState(null),[g,C]=v.useState(!0),[d,o]=v.useState(0),{id:b}=E();if(v.useEffect(()=>{(async()=>{var i;try{const a=await L.get(`${O}/api/test/response/${b}`,{withCredentials:!0});if((i=a.data)!=null&&i.status){const t=a.data.data;S(t);const r=$(t.response,t.testId);p(r)}}catch(a){console.error("Error fetching preview:",a.message)}finally{C(!1)}})()},[b]),g)return e.jsx("p",{className:"text-center py-6",children:"Loading..."});if(!w)return e.jsx("p",{className:"text-center py-6 text-red-500",children:"No data found"});const{testId:x,response:u}=w,h=u[d],l=x.sections.find(s=>s._id===h.sectionId),k=(l==null?void 0:l.name)||`Section ${d+1}`,j=h.sectionType;return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-6",children:["Test Preview: ",x==null?void 0:x.name]}),n&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg mb-6 border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-3 mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Full Test Analysis"}),e.jsx("span",{className:`px-4 py-1.5 rounded-full text-sm font-medium border ${n.verdict==="Pass"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:n.verdict})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Total Marks"}),e.jsx("p",{className:"mt-1 text-lg font-bold text-gray-800",children:n.totalMarks})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Obtained"}),e.jsx("p",{className:"mt-1 text-lg font-bold text-green-600",children:n.obtainedMarks})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Negative"}),e.jsx("p",{className:"mt-1 text-lg font-bold text-red-500",children:n.negativeMarks})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Cumulative"}),e.jsx("p",{className:"mt-1 text-lg font-bold text-gray-800",children:n.cumulativeMarks})]})]})]}),n&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Section Analysis"}),e.jsxs("table",{className:"w-full text-sm border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2",children:"Section"}),e.jsx("th",{className:"border p-2",children:"Type"}),e.jsx("th",{className:"border p-2",children:"Total"}),e.jsx("th",{className:"border p-2",children:"Obtained"}),e.jsx("th",{className:"border p-2",children:"Negative"}),e.jsx("th",{className:"border p-2",children:"Correct"}),e.jsx("th",{className:"border p-2",children:"Wrong"}),e.jsx("th",{className:"border p-2",children:"Skipped"})]})}),e.jsx("tbody",{children:n.sectionAnalysis.map((s,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:s.sectionName}),e.jsx("td",{className:"border p-2",children:s.sectionType}),e.jsx("td",{className:"border p-2",children:s.totalMarks}),e.jsx("td",{className:"border p-2",children:s.obtainedMarks}),e.jsx("td",{className:"border p-2",children:s.negativeMarks}),e.jsx("td",{className:"border p-2",children:s.correctCount}),e.jsx("td",{className:"border p-2",children:s.wrongCount}),e.jsx("td",{className:"border p-2",children:s.skippedCount})]},i))})]})]}),e.jsx("div",{className:"flex text-xs justify-center",children:e.jsx("p",{children:"Switch Sections"})}),e.jsxs("div",{className:"flex mb-5 items-center text-xs justify-center gap-3",children:[e.jsx(M,{disabled:d===0,onClick:()=>o(s=>s-1),className:"px-4 py-2 bg-gray-500 text-white rounded disabled:bg-gray-300",children:e.jsx(_,{})}),e.jsxs("span",{children:[d+1," / ",u.length]}),e.jsx(M,{disabled:d===u.length-1,onClick:()=>o(s=>s+1),className:"px-4 py-2 bg-gray-500 text-white rounded disabled:bg-gray-300",children:e.jsx(P,{})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[k," (",j,")"]}),j==="Quiz"&&((f=l==null?void 0:l.questionSet)==null?void 0:f.map((s,i)=>{var y,m,T;const a=h.quizAnswers.find(c=>c[s._id]!==void 0),t=a?a[s._id]:null,r=((m=(y=s.options)==null?void 0:y.find(c=>c.isCorrect))==null?void 0:m.text)||s.answer;let N="0";return t&&(N=t===r?`+${s.marks}`:`-${s.negative}`),e.jsxs("div",{className:"border p-4 mb-4 rounded bg-gray-50",children:[e.jsxs("p",{className:"font-medium mb-2",children:["Q",i+1,": ",s.question]}),((T=s.options)==null?void 0:T.length)>0&&e.jsx("ul",{className:"list-disc pl-5",children:s.options.map((c,A)=>e.jsxs("li",{className:c.text===r?"text-green-600 font-semibold":c.text===t&&c.text!==r?"text-red-600 font-semibold":"",children:[String.fromCharCode(65+A),". ",c.text]},c._id))}),e.jsxs("p",{children:["Your Answer: ",t||"Not Attempted"]}),e.jsxs("p",{children:["Correct Answer: ",r]}),e.jsxs("p",{className:"font-bold",children:["Marks: ",N]})]},s._id)})),j==="Coding"&&h.codingAnswers.map((s,i)=>{const a=Object.keys(s)[0],t=s[a];return e.jsxs("div",{className:"border p-4 mb-4 rounded bg-gray-50",children:[e.jsxs("p",{className:"font-medium mb-2",children:["Coding Problem ",i+1]}),e.jsxs("p",{children:["Marks: ",t.passedTestCases," / ",t.totalTestCases]}),e.jsx("pre",{className:"bg-white p-2 rounded border overflow-x-auto",children:t.code})]},a)})]})]})};export{D as default};

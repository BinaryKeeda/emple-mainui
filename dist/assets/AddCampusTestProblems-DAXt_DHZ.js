import{r as s,j as t,O as N,D as F,d as w,B as v}from"./index-DdMezOeP.js";import{B as x}from"./Box-BZYVI35U.js";import{T as A}from"./Typography-BWoUkV3k.js";import{T as I}from"./TextField-Baa67dWx.js";import{a as O}from"./Menu-B0Kmm_PV.js";import{L as z,a as D}from"./ListItemText-a2glftxm.js";import{C as H}from"./Checkbox-OtIDoYmH.js";import{B as W}from"./Button-BKzxvtFg.js";import"./extendSxProp-C_8yd4lt.js";import"./index-XNDWYAIk.js";import"./Select-C7sGlLw3.js";import"./Grow-C-yzhX98.js";import"./index-DIIh0Rwg.js";import"./useSlotProps-CfArIE5S.js";import"./Paper-n1SLl0Wg.js";import"./mergeSlotProps-DPnGKbge.js";import"./MenuItem-C9FTiuAk.js";import"./dividerClasses-DlulfXR3.js";import"./SwitchBase-DAtzKe4k.js";const U={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:800,maxHeight:"80vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function de({open:a,onSuccess:B,onClose:L,testId:$,sectionId:E}){const[d,m]=s.useState([]),[i,b]=s.useState([]),[g,u]=s.useState(1),[l,y]=s.useState(!1),[f,n]=s.useState(!0),[h,j]=s.useState(""),c=s.useRef(),_=s.useCallback(e=>{l||(c.current&&c.current.disconnect(),c.current=new IntersectionObserver(r=>{r[0].isIntersecting&&f&&u(o=>o+1)}),e&&c.current.observe(e))},[l,f]),S=async(e,r=!1)=>{y(!0);try{const p=(await w.get(`${v}/api/admin/problems?search=${h}&page=${e}&limit=10&sortBy=createdAt&sortOrder=desc`,{withCredentials:!0})).data.data||[];m(C=>r?p:[...C,...p.filter(T=>!C.some(M=>M._id===T._id))]),n(p.length>0)}catch(o){console.error("Error fetching problems:",o),n(!1)}finally{y(!1)}};s.useEffect(()=>{a&&S(g)},[g,a]),s.useEffect(()=>{a&&(m([]),u(1),n(!0),S(1,!0))},[h,a]);const k=e=>{b(r=>r.includes(e)?r.filter(o=>o!==e):[...r,e])},R=async()=>{if(i.length===0){alert("Please select at least one problem.");return}try{await w.put(`${v}/api/admin/campus/tests/${$}/sections/${E}/problems`,{problemIds:i},{withCredentials:!0}),alert("Problems added successfully!"),B(),P()}catch(e){console.error("Failed to add problems:",e),alert("Failed to add problems")}},P=()=>{m([]),b([]),u(1),n(!0),j(""),L()};return t.jsx(N,{open:a,onClose:P,children:t.jsxs(x,{sx:U,children:[t.jsx(A,{variant:"h6",mb:2,children:"Select Problems to Add"}),t.jsx(I,{size:"small",label:"Search problems",value:h,onChange:e=>j(e.target.value),fullWidth:!0,sx:{mb:2}}),t.jsx(O,{children:d.map((e,r)=>{const o=d.length===r+1;return t.jsx(z,{ref:o?_:null,divider:!0,secondaryAction:t.jsx(H,{edge:"end",checked:i.includes(e._id),onChange:()=>k(e._id)}),children:t.jsx(D,{primary:e.title,secondary:`Difficulty: ${e.difficulty}`})},e._id)})}),l&&t.jsx(x,{className:"flex justify-center mt-4",children:t.jsx(F,{size:24})}),!l&&!f&&d.length===0&&t.jsx(A,{className:"text-center mt-4",color:"textSecondary",children:"No problems found."}),t.jsx(x,{mt:2,className:"flex justify-end",children:t.jsxs(W,{variant:"contained",onClick:R,disabled:i.length===0,children:["Add Selected (",i.length,")"]})})]})})}export{de as default};

import{r as s,j as t,ab as N,_ as F,d as w,B as v}from"./index-DgAd_cHG.js";import{B as x}from"./Box-C2Wo7dQa.js";import{T as A}from"./Typography-B554UfoF.js";import{T as I}from"./TextField-DNw8uuyP.js";import{a as z}from"./Menu-TSpIh8XD.js";import{L as H,a as O}from"./ListItemText-CXrA_ish.js";import{C as W}from"./Checkbox-BwOK6AvO.js";import{B as D}from"./Button-CHCO0T1v.js";import"./extendSxProp-VXpTOIJU.js";import"./index-DstEP2X5.js";import"./Select-CD13feoT.js";import"./Grow-DEzq9W27.js";import"./index-D19HxtdB.js";import"./Paper-BPShevJQ.js";import"./mergeSlotProps-0-Zt_n3I.js";import"./MenuItem-Ceq6tXGI.js";import"./dividerClasses-aHMU7Idu.js";import"./SwitchBase-lXrTCPHj.js";const U={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:800,maxHeight:"80vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function ce({open:o,onSuccess:B,onClose:L,testId:_,sectionId:$}){const[d,m]=s.useState([]),[i,b]=s.useState([]),[g,u]=s.useState(1),[l,y]=s.useState(!1),[f,n]=s.useState(!0),[h,j]=s.useState(""),c=s.useRef(),E=s.useCallback(e=>{l||(c.current&&c.current.disconnect(),c.current=new IntersectionObserver(r=>{r[0].isIntersecting&&f&&u(a=>a+1)}),e&&c.current.observe(e))},[l,f]),S=async(e,r=!1)=>{y(!0);try{const p=(await w.get(`${v}/api/admin/problems?search=${h}&page=${e}&limit=10&sortBy=createdAt&sortOrder=desc`,{withCredentials:!0})).data.data||[];m(C=>r?p:[...C,...p.filter(T=>!C.some(M=>M._id===T._id))]),n(p.length>0)}catch(a){console.error("Error fetching problems:",a),n(!1)}finally{y(!1)}};s.useEffect(()=>{o&&S(g)},[g,o]),s.useEffect(()=>{o&&(m([]),u(1),n(!0),S(1,!0))},[h,o]);const k=e=>{b(r=>r.includes(e)?r.filter(a=>a!==e):[...r,e])},R=async()=>{if(i.length===0){alert("Please select at least one problem.");return}try{await w.put(`${v}/api/admin/campus/tests/${_}/sections/${$}/problems`,{problemIds:i},{withCredentials:!0}),alert("Problems added successfully!"),B(),P()}catch(e){console.error("Failed to add problems:",e),alert("Failed to add problems")}},P=()=>{m([]),b([]),u(1),n(!0),j(""),L()};return t.jsx(N,{open:o,onClose:P,children:t.jsxs(x,{sx:U,children:[t.jsx(A,{variant:"h6",mb:2,children:"Select Problems to Add"}),t.jsx(I,{size:"small",label:"Search problems",value:h,onChange:e=>j(e.target.value),fullWidth:!0,sx:{mb:2}}),t.jsx(z,{children:d.map((e,r)=>{const a=d.length===r+1;return t.jsx(H,{ref:a?E:null,divider:!0,secondaryAction:t.jsx(W,{edge:"end",checked:i.includes(e._id),onChange:()=>k(e._id)}),children:t.jsx(O,{primary:e.title,secondary:`Difficulty: ${e.difficulty}`})},e._id)})}),l&&t.jsx(x,{className:"flex justify-center mt-4",children:t.jsx(F,{size:24})}),!l&&!f&&d.length===0&&t.jsx(A,{className:"text-center mt-4",color:"textSecondary",children:"No problems found."}),t.jsx(x,{mt:2,className:"flex justify-end",children:t.jsxs(D,{variant:"contained",onClick:R,disabled:i.length===0,children:["Add Selected (",i.length,")"]})})]})})}export{ce as default};

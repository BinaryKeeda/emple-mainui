import{i as B,r as o,b as L,M as R,j as e,L as C,ad as k}from"./index-DuMHTSdw.js";import{u as F}from"./TestProvider-Cg2W7S0d.js";import{T as J}from"./TextField-DS3DH8Ob.js";import{B as P}from"./Button-CjMKz1A8.js";import"./useQuery-DFFnEaxW.js";import"./Select-ulCrDANk.js";import"./Menu-DhppiPkq.js";import"./index-CRzeOzbS.js";import"./Grow-BjJ8mM2A.js";import"./Paper-tsmsi79X.js";import"./mergeSlotProps-CFfg8Mmd.js";import"./index-DGHOctzD.js";import"./extendSxProp-d_nzIvff.js";const te=({timeLeft:p})=>{var y;const{currSection:m,loading:j,setIsSubmitted:_,testResponse:A,setCurr:$,sections:E}=F(),{slug:b}=B(),[h,V]=o.useState(m.questionSet),[i,c]=o.useState({}),[g,w]=o.useState(new Set),[M,x]=o.useState(!1),[d,u]=o.useState(0),[I,v]=o.useState(),a=m.questionSet[d],f=s=>{var t;return((t=s==null?void 0:s.options)==null?void 0:t.filter(n=>n.isCorrect).length)>1},T=(s,t)=>{const n=s._id;f(s)?c(l=>{const r=new Set(l[n]||[]);return r.has(t)?r.delete(t):r.add(t),{...l,[n]:Array.from(r)}}):c(l=>({...l,[n]:t}))},U=(s,t)=>{c(n=>({...n,[s]:t}))},z=s=>{var S;const t=((S=h[d])==null?void 0:S._id)===s,n=i[s]&&(Array.isArray(i[s])?i[s].length>0:i[s]),l=g.has(s);let r=" p-2 border text-sm rounded-full ";return t?`${r} bg-blue-600 text-white border-blue-700`:n?`${r} bg-green-600/20 border-green-400 text-green-800`:l?`${r} bg-orange-100 border-orange-400 text-orange-800`:`${r} bg-blue-100 border-blue-400 text-blue-600`};o.useEffect(()=>{a!=null&&a._id&&w(s=>new Set(s).add(a._id))},[d,a]),o.useEffect(()=>{const s=sessionStorage.getItem(`solution-${b}`);if(s){const t=JSON.parse(s);c(t.answers||{}),w(new Set(t.visited||[])),u(t.currentIndex||0)}},[]),o.useEffect(()=>{p<=0&&N(!0)},[p]),o.useEffect(()=>{j||sessionStorage.setItem(`solution-${b}`,JSON.stringify({answers:i,visited:Array.from(g),currentIndex:d}))},[i,g,d]);const N=async(s=!1)=>{var t;try{v(!0);const n=await L.post(`${R}/api/v4/eval/test/submit/section`,{sectionId:m._id,submissionId:A._id,sectionType:"Quiz",quizAnswers:i,sectionLength:E.length,codingAnswers:null,autoSubmit:s});sessionStorage.removeItem(`solution-${b}`),console.log("Chl rha hai"),$(l=>l+1),console.log(n.data),_(((t=n==null?void 0:n.data)==null?void 0:t.isSubmitted)||!1)}catch(n){console.log(n)}finally{x(!1),v(!1)}};return j?e.jsx("div",{className:"h-screen flex justify-center items-center w-screen",children:e.jsx(C,{})}):e.jsx(e.Fragment,{children:e.jsxs("main",{className:"flex bg-white flex-col lg:flex-row h-[calc(100vh-60px)] pt-[0px]",children:[e.jsxs("section",{className:"flex-1 p-5 flex flex-col justify-betwee",children:[e.jsxs("div",{className:"border p-8 rounded-sm shadow-sm",children:[e.jsx("div",{className:"flex justify-between",children:e.jsxs("p",{className:"mb-6 text-base",children:["Q",d+1,". ",a==null?void 0:a.question]})}),(a==null?void 0:a.image)&&e.jsx("img",{className:"h-[260px] mb-4",src:a==null?void 0:a.image,alt:""}),e.jsxs("div",{className:"space-y-4",children:[((y=a==null?void 0:a.options)==null?void 0:y.length)>0?a.options.map((s,t)=>{var r;const n=a._id,l=f(a)?(r=i[n])==null?void 0:r.includes(s.text):i[n]===s.text;return e.jsxs("label",{className:`flex items-center p-3 border rounded-md cursor-pointer transition ${l?"border-blue-600 bg-blue-50":"border-gray-300"}`,children:[e.jsx("input",{type:f(a)?"checkbox":"radio",className:"mr-3",name:`question-${n}`,value:s.text,checked:l,onChange:()=>T(a,s.text)}),e.jsx("span",{children:s.text})]},t)}):e.jsx(J,{label:"Your Answer",fullWidth:!0,value:i[a._id]||"",onChange:s=>U(a._id,s.target.value)}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>{c(s=>{const t={...s};return delete t[a._id],t})},className:"text-sm text-gray-700",children:"Clear choice"})})]})]}),e.jsxs("div",{className:"mt-8 flex gap-4 justify-end",children:[e.jsx("button",{onClick:()=>u(s=>Math.max(s-1,0)),disabled:d===0,className:"px-4 py-2 rounded-md bg-[#1876d2] text-white text-sm disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>u(s=>Math.min(s+1,h.length-1)),disabled:d===h.length-1,className:"px-4 py-2 rounded-md bg-[#1876d2] text-white text-sm disabled:opacity-50",children:"Next"})]})]}),e.jsxs("section",{className:"lg:w-1/4 p-6  flex flex-col justify-between border-t gap-10 lg:border-t-0 lg:border-l border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-4",children:"Question Navigator"}),e.jsx("div",{className:"grid grid-cols-6 gap-2 lg:grid-cols-5",children:m.questionSet.map((s,t)=>e.jsx("button",{className:`rounded-full ${z(s._id)} rounded-full h-[40px] w-[40px]`,onClick:()=>u(t),children:t+1},s._id))})]}),e.jsxs("div",{className:"flex flex-col justify-between gap-6",children:[e.jsxs("div",{className:"mt-6 text-sm grid grid-cols-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 bg-blue-700 inline-block rounded-full"})," ","Current"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 bg-green-100 border border-green-400 inline-block rounded-full"})," ","Attempted"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 bg-orange-100 border border-orange-400 inline-block rounded-full"})," ","Seen"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 bg-blue-100 border border-blue-400 inline-block rounded-full"})," ","Unseen"]})]}),e.jsx(P,{fullWidth:!0,onClick:()=>x(!0),variant:"contained",color:"primary",className:"mt-6",children:"Submit"})]})]}),e.jsx(k,{open:M,onClose:()=>x(!1),children:e.jsxs("div",{style:{transform:"translate(-50%, -50%)"},className:"relative top-[50%] left-[50%] p-6 w-2/5 min-w-[40%] max-w-[40%] rounded-lg bg-white shadow-lg",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"flex shrink-0 items-center pb-4 text-xl font-medium text-slate-800",children:"Are you sure you want to submit?"}),e.jsxs("div",{className:"relative border-t border-slate-200 py-4 leading-normal text-slate-600 font-light",children:["This action is"," ",e.jsx("span",{className:"font-semibold text-red-600",children:"irreversible"}),". Once submitted, your changes cannot be undone."]}),e.jsxs("div",{className:"flex shrink-0 flex-wrap items-center pt-4 justify-end",children:[e.jsx("button",{onClick:()=>{x(!1)},"data-dialog-close":"true",className:"rounded-md border border-transparent py-2 px-4 text-center text-sm transition-all text-slate-600 hover:bg-slate-100 focus:bg-slate-100 active:bg-slate-100 disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none",type:"button",children:"Cancel"}),e.jsx("button",{onClick:()=>{N(!1)},"data-dialog-close":"true",className:"rounded-md bg-green-600 py-2 px-4 border border-transparent text-center text-sm text-white transition-all shadow-md hover:shadow-lg focus:bg-green-700 focus:shadow-none active:bg-green-700 hover:bg-green-700 active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none ml-2",type:"button",children:"Confirm"})]})]})}),e.jsx(k,{open:I||!1,children:e.jsx("div",{style:{transform:"translate(-50%, -50%)"},className:"relative top-[50%] left-[50%] p-6 w-2/5 min-w-[40%] max-w-[40%] rounded-lg bg-white shadow-lg",role:"dialog","aria-modal":"true",children:e.jsx(C,{})})})]})})};export{te as default};

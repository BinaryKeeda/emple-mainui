import{e as I,j as e,r as N,i as E,I as S,ae as _,d as L,B as O}from"./index-B9lI-E5Z.js";const P=I(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos"),$=(f,C)=>{let n=0,m=0,g=0,y=[];return f.forEach(d=>{var j;const o=C.sections.find(s=>s._id===d.sectionId),w=(o==null?void 0:o.questionSet)||[];let x=0,p=0,h=0,l=0,v=0,b=0;if(d.sectionType==="Quiz"){const s=Object.assign({},...d.quizAnswers);w.forEach(t=>{var i;const r=s[t._id]||null;if(x+=t.marks,n+=t.marks,!r){b++;return}let a=!1;if(t.category==="Text")a=((i=t.answer)==null?void 0:i.trim().toLowerCase())===(r==null?void 0:r.trim().toLowerCase());else{const u=t.options.find(k=>k.isCorrect);a=(u==null?void 0:u.text)===r}a?(p+=t.marks,m+=t.marks,l++):(v++,t.negative&&(h+=t.negative,g+=t.negative))})}d.sectionType==="Coding"&&((j=d.codingAnswers)==null||j.forEach(s=>{const t=Object.keys(s)[0],r=s[t],a=r.totalTestCases||0,i=r.passedTestCases||0;x+=a,p+=i,n+=a,m+=i})),y.push({sectionName:(o==null?void 0:o.name)||"Untitled Section",sectionType:d.sectionType,totalMarks:x,obtainedMarks:p,negativeMarks:h,correctCount:l,wrongCount:v,skippedCount:b})}),{totalMarks:n,obtainedMarks:m,negativeMarks:g,cumulativeMarks:m-g,sectionAnalysis:y,verdict:m-g>=n*.4?"Pass":"Fail"}},D=()=>{var j;const[f,C]=N.useState(null),[n,m]=N.useState(null),[g,y]=N.useState(!0),[d,o]=N.useState(0),{id:w}=E();if(N.useEffect(()=>{(async()=>{var t;try{const r=await L.get(`${O}/api/test/response/${w}`,{withCredentials:!0});if((t=r.data)!=null&&t.status){const a=r.data.data;C(a);const i=$(a.response,a.testId);m(i)}}catch(r){console.error("Error fetching preview:",r.message)}finally{y(!1)}})()},[w]),g)return e.jsx("p",{className:"text-center py-6",children:"Loading..."});if(!f)return e.jsx("p",{className:"text-center py-6 text-red-500",children:"No data found"});const{testId:x,response:p}=f,h=p[d],l=x.sections.find(s=>s._id===h.sectionId),v=(l==null?void 0:l.name)||`Section ${d+1}`,b=h.sectionType;return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("h2",{className:"text-3xl font-bold mb-6",children:["Test Preview: ",x==null?void 0:x.name]}),n&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg mb-6 border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-3 mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Full Test Analysis"}),e.jsx("span",{className:`px-4 py-1.5 rounded-full text-sm font-medium border ${n.verdict==="Pass"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:n.verdict})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Total Marks"}),e.jsx("p",{className:"mt-1 text-lg font-bold text-gray-800",children:n.totalMarks})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Obtained"}),e.jsx("p",{className:"mt-1 text-lg font-bold text-green-600",children:n.obtainedMarks})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Negative"}),e.jsx("p",{className:"mt-1 text-lg font-bold text-red-500",children:n.negativeMarks})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-100",children:[e.jsx("p",{className:"text-xs uppercase tracking-wider text-gray-500",children:"Cumulative"}),e.jsx("p",{className:"mt-1 text-lg font-bold text-gray-800",children:n.cumulativeMarks})]})]})]}),n&&e.jsxs("div",{className:"bg-white overflow-auto p-6 rounded-lg shadow mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Section Analysis"}),e.jsxs("table",{className:"w-full overflow-x-auto max-w-screen text-sm border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2",children:"Section"}),e.jsx("th",{className:"border p-2",children:"Type"}),e.jsx("th",{className:"border p-2",children:"Total"}),e.jsx("th",{className:"border p-2",children:"Obtained"}),e.jsx("th",{className:"border p-2",children:"Negative"}),e.jsx("th",{className:"border p-2",children:"Correct"}),e.jsx("th",{className:"border p-2",children:"Wrong"}),e.jsx("th",{className:"border p-2",children:"Skipped"})]})}),e.jsx("tbody",{children:n.sectionAnalysis.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:s.sectionName}),e.jsx("td",{className:"border p-2",children:s.sectionType}),e.jsx("td",{className:"border p-2",children:s.totalMarks}),e.jsx("td",{className:"border p-2",children:s.obtainedMarks}),e.jsx("td",{className:"border p-2",children:s.negativeMarks}),e.jsx("td",{className:"border p-2",children:s.correctCount}),e.jsx("td",{className:"border p-2",children:s.wrongCount}),e.jsx("td",{className:"border p-2",children:s.skippedCount})]},t))})]})]}),e.jsx("div",{className:"flex text-xs justify-center",children:e.jsx("p",{children:"Switch Sections"})}),e.jsxs("div",{className:"flex mb-5 items-center text-xs justify-center gap-3",children:[e.jsx(S,{disabled:d===0,onClick:()=>o(s=>s-1),className:"px-4 py-2 bg-gray-500 text-white rounded disabled:bg-gray-300",children:e.jsx(_,{})}),e.jsxs("span",{children:[d+1," / ",p.length]}),e.jsx(S,{disabled:d===p.length-1,onClick:()=>o(s=>s+1),className:"px-4 py-2 bg-gray-500 text-white rounded disabled:bg-gray-300",children:e.jsx(P,{})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[v," (",b,")"]}),b==="Quiz"&&((j=l==null?void 0:l.questionSet)==null?void 0:j.map((s,t)=>{var k,T,A;const r=h.quizAnswers.find(c=>c[s._id]!==void 0),a=r?r[s._id]:null,i=((T=(k=s.options)==null?void 0:k.find(c=>c.isCorrect))==null?void 0:T.text)||s.answer;let u="0";return a&&(u=a===i?`+${s.marks}`:`-${s.negative}`),e.jsxs("div",{className:"border p-4 mb-4 rounded bg-gray-50",children:[e.jsxs("p",{className:"font-medium mb-2",children:["Q",t+1,": ",s.question]}),((A=s.options)==null?void 0:A.length)>0&&e.jsx("ul",{className:"list-disc pl-5",children:s.options.map((c,M)=>e.jsxs("li",{className:c.text===i?"text-green-600 font-semibold":c.text===a&&c.text!==i?"text-red-600 font-semibold":"",children:[String.fromCharCode(65+M),". ",c.text]},c._id))}),e.jsxs("p",{children:["Your Answer: ",a||"Not Attempted"]}),e.jsxs("p",{children:["Correct Answer: ",i]}),e.jsxs("p",{className:"font-bold",children:["Marks: ",u]})]},s._id)})),b==="Coding"&&h.codingAnswers.map((s,t)=>{const r=Object.keys(s)[0],a=s[r];return e.jsxs("div",{className:"border p-4 mb-4 rounded bg-gray-50",children:[e.jsxs("p",{className:"font-medium mb-2",children:["Coding Problem ",t+1]}),e.jsxs("p",{children:["Marks: ",a.passedTestCases," / ",a.totalTestCases]}),e.jsx("pre",{className:"bg-white p-2 rounded border overflow-x-auto",children:a.code})]},r)})]})]})};export{D as default};

import{d as $,r as m,B as F,a as Q,j as e,O as P,Q as Y,S as q,I as G,C as J,L as U}from"./index-Cnot-2ym.js";import{a as z,u as D}from"./TestOutputContext-WdeHfnTD.js";import{d as V}from"./index-43sa7Js6.js";import{A as Z,a as ee}from"./ArrowRight-CRcZi3Sa.js";import"./useQuery-DAbvGF-e.js";const B=s=>typeof s=="string"?decodeURIComponent(escape(atob(s))):"",se=async(s,t,a)=>{const i=s.map(u=>typeof u=="string"?u:u.token);for(let u=0;u<10;u++)try{const g=(await $.get(`${t}/submissions/batch?tokens=${i.join(",")}&base64_encoded=true`,{headers:{"X-Auth-User":"binarykeeda-admin-token-bkzsecure","X-Auth-Token":"binarykeeda-admin-authtoken-secure"}})).data.submissions;if(g.every(n=>{var b;return[3,4,6,11].includes((b=n.status)==null?void 0:b.id)}))return g.map(n=>({stdout:n.stdout?B(n.stdout).trim():"",stderr:n.stderr?B(n.stderr).trim():"",compile_error:n.compile_output?B(n.compile_output).trim():"",time:n.time||"0",memory:n.memory||"0",status:n.status}));await new Promise(n=>setTimeout(n,2e3))}catch(f){return console.error("Batch fetch error:",f),i.map(()=>({stdout:"",stderr:"Failed to fetch result.",compile_error:"",time:"0",memory:"0",status:{id:-1,description:"Fetch error"}}))}return i.map(()=>({stdout:"",stderr:"Timed out.",compile_error:"",time:"0",memory:"0",status:{id:-2,description:"Timed out"}}))},te=s=>({cpp:54,c:50,java:62,python:71})[s]||71,ne=({CODE_EXECUTION_API:s,headers:t})=>({runTests:m.useCallback(async({code:c,language:h,testCases:i,problemName:u,problemId:f})=>{const g=[];let o=0,n=0,b=0;try{const I=(await $.post(`${F}/api/judge0/eval`,{code:c,language:h,problemId:f},{withCredentials:!0})).data.tokens;(await se(I,s,t)).forEach((w,S)=>{const L=i[S],C=(w.stdout||"").trim(),r=L.output.trim(),d=C===r;d&&o++,n+=parseFloat(w.time||0),b+=parseInt(w.memory||0),g.push({input:L.input,output:C,expected:r,passed:d,error:w.stderr||w.compile_error||""})});const j=n/i.length,N=b/i.length;return{summary:{passed:o,failed:i.length-o,total:i.length,avgTime:j.toFixed(3),avgMemory:N.toFixed(2)},results:g,review:{}}}catch(R){return console.error(R),{summary:null,results:[],review:null}}},[s,te,t])});function ae({setSubmitting:s,problem:t}){const{user:a}=Q(l=>l.auth),{showOutputWindow:c,setShowOutputWindow:h,results:i,setResults:u,isExecuting:f,setIsExecuting:g,summary:o,setSummary:n,codeReview:b,setCodeReview:R}=z(),{testResponse:T,currSection:I,setProblemsSolved:v}=D(),j=t._id,N=l=>`${j}_${l}_code`,M=()=>`${j}_language`,w="java",[S,L]=m.useState(w),[C,r]=m.useState(""),[d,x]=m.useState(!1);m.useEffect(()=>{var A,p,k,E;const l=(A=t.functionSignature)!=null&&A.some(_=>_.language===w)?w:(k=(p=t.functionSignature)==null?void 0:p[0])==null?void 0:k.language;sessionStorage.setItem(M(),l);const y=sessionStorage.getItem(N(l));if(y)r(y);else{const _=(E=t.functionSignature)==null?void 0:E.find(H=>H.language===l);_?(r(_.signature),sessionStorage.setItem(N(l),_.signature)):r("")}L(l)},[t]);const O=l=>{var E;const y=l.target.value;if(!confirm("Are you sure you want to switch language? Unsaved changes will be lost."))return;sessionStorage.setItem(M(),y);const p=sessionStorage.getItem(N(y)),k=(E=t.functionSignature)==null?void 0:E.find(_=>_.language===y);p?r(p):k?(r(k.signature),sessionStorage.setItem(N(y),k.signature)):r(""),L(y)},K=l=>{r(l),sessionStorage.setItem(N(S),l)},{runTests:X}=ne({CODE_EXECUTION_API:Y,headers:q}),W=async(l,y,A)=>{try{x(!1),h(!0),n(null),u(null),g(!0),R(null);const{summary:p,results:k,review:E}=await X({code:y,language:l,testCases:t.testCases,problemName:t.problemName,problemId:t._id});A?(s(!0),await $.post(`${F}/api/judge0/submit`,{userId:a==null?void 0:a._id,problemId:t==null?void 0:t._id,responseId:T==null?void 0:T._id,language:l,sourceCode:y,codeReview:E,passedTestCases:p.passed,totalTestCases:p.total,executionTime:p.avgTime,memoryUsed:p.avgMemory,sectionId:I._id},{withCredentials:!0}),v(_=>[..._,{problemId:t._id}]),h(!1),s(!1)):(n(p),u(k),R(E))}catch{}finally{g(!1)}};return e.jsxs("div",{className:"h-[calc(100vh-60px)] overflow-hidden",children:[e.jsxs("div",{className:"h-[47px] flex justify-between px-4 items-center gap-2 p-2 border-b w-full shadow-sm mb-1",children:[e.jsx("select",{className:"border border-slate-300 rounded px-2 py-1 text-sm text-slate-700",value:S,onChange:O,children:t.functionSignature.map(l=>e.jsx("option",{value:l.language,children:l.language.toUpperCase()},l.language))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex items-center rounded-md border border-slate-300 py-2 px-4 text-sm shadow-sm hover:shadow-lg text-slate-600 hover:text-white hover:bg-slate-800 hover:border-slate-800",onClick:()=>W(S,C,!1),children:f?"Running ...":"Run"}),e.jsx("button",{className:"flex items-center rounded-md border border-slate-300 py-2 px-4 text-sm shadow-sm hover:shadow-lg text-slate-600 hover:text-white hover:bg-slate-800 hover:border-slate-800",onClick:()=>x(!0),children:"Submit"})]})]}),e.jsx("div",{className:"py-2",children:e.jsx(V,{language:S,value:C,onChange:K,theme:"vs-light",height:"calc(100vh - (60px + 47px + 16px))"})}),e.jsx(P,{open:d,onClose:()=>x(!1),children:e.jsxs("div",{style:{transform:"translate(-50%, -50%)"},className:"relative top-[50%] left-[50%] p-6 w-2/5 min-w-[40%] max-w-[40%] rounded-lg bg-white shadow-lg",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"flex shrink-0 items-center pb-4 text-xl font-medium text-slate-800",children:"Are you sure you want to submit?"}),e.jsxs("div",{className:"relative border-t border-slate-200 py-4 leading-normal text-slate-600 font-light",children:["This action is"," ",e.jsx("span",{className:"font-semibold text-red-600",children:"irreversible"}),". Once submitted, your changes cannot be undone."]}),e.jsxs("div",{className:"flex shrink-0 flex-wrap items-center pt-4 justify-end",children:[e.jsx("button",{onClick:()=>{x(!1)},"data-dialog-close":"true",className:"rounded-md border border-transparent py-2 px-4 text-center text-sm transition-all text-slate-600 hover:bg-slate-100 focus:bg-slate-100 active:bg-slate-100 disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none",type:"button",children:"Cancel"}),e.jsx("button",{onClick:()=>W(S,C,!0),"data-dialog-close":"true",className:"rounded-md bg-green-600 py-2 px-4 border border-transparent text-center text-sm text-white transition-all shadow-md hover:shadow-lg focus:bg-green-700 focus:shadow-none active:bg-green-700 hover:bg-green-700 active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none ml-2",type:"button",children:"Confirm"})]})]})})]})}function re(){const{showOutputWindow:s,setShowOutputWindow:t,isExecuting:a,results:c=[],summary:h,codeReview:i}=z(),u=["indentation","modularity","variable_name_convention","time_complexity","space_complexity"],f=u.filter(o=>((i==null?void 0:i[o])||0)>0).length,g=u.length-f;return e.jsx("div",{className:`h-[calc(100%-0px)] overflow-scroll relative transition-all duration-200 ease-linear w-full ${s?"-translate-y-[calc(100%)]":"translate-y-0"} bg-gray-50`,children:e.jsxs("div",{className:"absolute top-0 w-full flex flex-col p-5 space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(G,{onClick:()=>t(o=>!o),children:e.jsx(J,{})})}),(!h||!c)&&e.jsx(U,{}),h&&e.jsxs("div",{className:"bg-white px-6 py-4 rounded shadow flex justify-between items-center",children:[e.jsxs("span",{className:"text-blue-600 font-medium text-lg",children:[h.passed,"/",h.total," Test Cases Passed"]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["â± Avg Time: ",e.jsxs("strong",{children:[h.avgTime,"s"]})]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["ðŸ’¾ Avg Memory: ",e.jsxs("strong",{children:[h.avgMemory," KB"]})]})]}),i&&e.jsxs("div",{className:"bg-white px-6 py-4 rounded shadow flex justify-between items-center",children:[e.jsx("span",{className:"text-purple-600 font-medium text-lg",children:"Code Review"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:f})," Passed, ",e.jsx("strong",{children:g})," Failed"]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Score: ",e.jsx("strong",{children:i.finalScore})]})]}),(c==null?void 0:c.length)>0&&e.jsxs("div",{className:"bg-white px-6 py-4 rounded shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Test Case Results"}),e.jsx("div",{className:"space-y-3",children:c.slice(0,2).map((o,n)=>e.jsxs("div",{className:`p-4 rounded border text-sm ${o.passed?"border-green-400 bg-green-50":"border-red-400 bg-red-50"}`,children:[e.jsxs("p",{className:"font-medium text-gray-800 mb-2",children:["Test Case #",n+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",e.jsx("code",{children:o.input})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected:"})," ",e.jsx("code",{children:o.expected})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Your Output:"})," ",e.jsx("code",{children:o.output})]}),!o.passed&&e.jsxs("p",{className:"text-red-500",children:[e.jsx("strong",{children:"Error:"})," ",o.error||"Incorrect Output"]})]},n))})]}),i&&e.jsxs("div",{className:"bg-white px-6 py-4 rounded shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Code Review Breakdown"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 text-sm",children:u.map((o,n)=>e.jsxs("div",{className:`p-3 rounded font-medium ${i[o]>0?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[o.replace(/_/g," "),": ",i[o]]},n))})]})]})})}function me({timeLeft:s}){const{currSection:t,test:a,setIsSubmitted:c,testResponse:h,loading:i,problemsSolved:u,setCurr:f}=D(),[g,o]=m.useState(50),n=m.useRef(null),b=m.useRef(!1),[R,T]=m.useState(!1),I=m.useMemo(()=>new Set(u.map(r=>r.problemId)),[u]),v=m.useMemo(()=>(t==null?void 0:t.problemset)||[],[t]),[j,N]=m.useState(0),M=async()=>$.post(`${F}/api/test/submit-section`,{testResponseId:h._id,testSectionLength:a.sections.length,ufm:localStorage.getItem("ufm")},{withCredentials:!0}).then(r=>{console.log(r),c(r.data.isSubmitted),f(d=>d+1)}).catch(r=>{console.log(r)});m.useEffect(()=>{s<=0&&(T(!0),M(),T(!1))},[s]),m.useEffect(()=>{if(!t)return;if(v.every(d=>I.has(d._id||d.id)))M();else if(j>=v.length||I.has(v[j]._id||v[j].id)){const d=v.findIndex(x=>!I.has(x._id||x.id));d!==-1&&N(d)}},[t,I,v,j]);const w=()=>{b.current=!0},S=r=>{if(!b.current||!n.current)return;const d=n.current.getBoundingClientRect().width,x=r.clientX/d*100;x>20&&x<80&&o(x)},L=()=>{b.current=!1};if(m.useEffect(()=>(window.addEventListener("mousemove",S),window.addEventListener("mouseup",L),()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",L)}),[]),i)return e.jsx("div",{className:"w-full h-[calc(100vh-60px)] flex items-center justify-center text-lg text-gray-600",children:"Loading..."});if(!t)return e.jsx(e.Fragment,{children:"No section loaded"});const C=v[j];return C?e.jsxs("section",{ref:n,className:"h-[calc(100vh-60px)] w-full flex overflow-hidden",children:[e.jsxs("div",{className:"h-full overflow-y-hidden border-r bg-gray-50",style:{width:`${g}%`},children:[e.jsx("div",{className:"flex gap-2 p-2 border-b bg-white flex-wrap",children:v.map((r,d)=>{const x=r._id||r.id,O=I.has(x);return e.jsxs("button",{onClick:()=>N(d),className:`px-3 py-1 text-sm border rounded 
                  ${O?"opacity-50 cursor-not-allowed":j===d?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-blue-100"}
                `,disabled:O,children:["Problem ",d+1]},x)})}),e.jsx(oe,{problem:C}),e.jsx(re,{})]}),e.jsx("div",{className:"w-[2px] flex items-center justify-center bg-gray-50 hover:bg-gray-600 transition duration-150 relative z-10",children:e.jsxs("div",{onMouseDown:w,className:"cursor-col-resize text-gray-900 select-none text-2xl gap-1 rounded-full w-[20px] h-[20px] flex items-center bg-gray-600 z-50",children:[e.jsx(Z,{sx:{marginLeft:-.5,color:"#FFF",fontSize:20}}),e.jsx(ee,{sx:{marginLeft:-2,fontSize:20,color:"#fff"}})]})}),e.jsx("div",{className:"h-full overflow-y-auto bg-white",style:{width:`${100-g}%`},children:e.jsx(ae,{setSubmitting:T,problem:C})}),e.jsx(P,{open:R||!1,children:e.jsx("div",{style:{transform:"translate(-50%, -50%)"},className:"relative top-[50%] left-[50%] p-6 w-2/5 min-w-[40%] max-w-[40%] rounded-lg bg-white shadow-lg",role:"dialog","aria-modal":"true",children:e.jsx(U,{})})})]}):e.jsx("div",{className:"p-4",children:"All problems solved âœ…"})}const oe=({problem:s})=>{var t;return e.jsx("div",{className:"flex-[0.6] bg-white font-[Lato] h-[calc(100%-50px)] overflow-y-scroll relative min-w-[200px] custom-scrollbar",children:e.jsxs("div",{className:"flex-[0.4] overflow-y-scroll h-full p-4 space-y-4 text-sm",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s==null?void 0:s.title}),e.jsx("div",{children:e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:s==null?void 0:s.description})}),(s==null?void 0:s.constraints)&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Constraints"}),e.jsx("ul",{className:"list-disc list-inside text-gray-600",children:s.constraints.map((a,c)=>e.jsx("li",{children:a},c))})]}),((t=s==null?void 0:s.examples)==null?void 0:t.length)>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Sample testcases"}),e.jsx("div",{className:"flex flex-col gap-4",children:s.examples.map((a,c)=>e.jsxs("div",{className:"bg-gray-200 p-3 rounded-md",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Input:"})," "," ",e.jsx("br",{}),e.jsx("p",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.input.replace(/\n/g,"<br/>")},className:"bg-gray-100 px-1 py-0.5 rounded"})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Output:"})," "," ",e.jsx("br",{}),e.jsx("p",{className:"bg-gray-100 px-1 py-0.5 rounded",children:a==null?void 0:a.output})]}),a.explanation&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Explanation:"})," ",a.explanation]})]},c))})]}),(s==null?void 0:s.sampleTestCases)&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Sample Test Cases"}),s.sampleTestCases.map((a,c)=>e.jsxs("div",{className:"mb-2 p-2 bg-gray-100 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," ",e.jsx("div",{dangerouslySetInnerHTML:{__html:a.input}})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Output:"})," ",a.output]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Explanation:"})," ",a.explanation]})]},c))]})]})})};export{me as default};

import{i as J,r as d,d as K,M as P,j as s,L as $,O as A}from"./index-GnGT0G9-.js";import{u as V}from"./TestOutputContext-DC2wXW79.js";import{T as W}from"./TextField-Xkk1ZyqS.js";import{B as y}from"./Button-YO9ZijG0.js";import"./useQuery-CPOjcNba.js";import"./Select-CEWOnSJ5.js";import"./Menu-C0MYbkt8.js";import"./index-BOgmRipr.js";import"./useSlotProps-DQsF1HqT.js";import"./Paper-B8SN4npd.js";import"./Grow-DXLh7ruH.js";import"./mergeSlotProps-BDz01fH2.js";import"./index-DZ_2OE68.js";import"./extendSxProp-CoD2AlFp.js";const ie=({timeLeft:w})=>{var C;const{currSection:l,loading:N,setIsSubmitted:k,testResponse:E,setCurr:M,sections:I,curr:h}=V(),{slug:g}=J(),[m,T]=d.useState([]),[o,x]=d.useState({}),[b,p]=d.useState(new Set),[z,f]=d.useState(!1),[c,u]=d.useState(0),[B,S]=d.useState(!1),t=m[c],j=e=>{var r;return((r=e==null?void 0:e.options)==null?void 0:r.filter(i=>i.isCorrect).length)>1},L=(e,r)=>{const i=e._id;j(e)?x(n=>{const a=new Set(n[i]||[]);return a.has(r)?a.delete(r):a.add(r),{...n,[i]:Array.from(a)}}):x(n=>({...n,[i]:r}))},R=(e,r)=>{x(i=>({...i,[e]:r}))},U=e=>{var _;const r=((_=m[c])==null?void 0:_._id)===e,i=o[e]&&(Array.isArray(o[e])?o[e].length>0:o[e]),n=b.has(e);let a=" p-2 border text-sm rounded-full ";return r?`${a} bg-blue-600 text-white border-blue-700`:i?`${a} bg-green-600/20 border-green-400 text-green-800`:n?`${a} bg-orange-100 border-orange-400 text-orange-800`:`${a} bg-blue-100 border-blue-400 text-blue-600`};d.useEffect(()=>{if(!l||!l.questionSet)return;T(l.questionSet);const e=`solution-${g}-${h}`,r=sessionStorage.getItem(e);if(r){const i=JSON.parse(r);x(i.answers||{}),p(new Set(i.visited||[])),u(i.currentIndex||0)}else p(new Set),x({}),u(0)},[l,h]),d.useEffect(()=>{t!=null&&t._id&&p(e=>new Set(e).add(t._id))},[c,t]),d.useEffect(()=>{w<=0&&v(!0)},[w]),d.useEffect(()=>{if(!l||N)return;const e=`solution-${g}-${h}`;sessionStorage.setItem(e,JSON.stringify({answers:o,visited:Array.from(b),currentIndex:c}))},[o,b,c,l]);const v=async(e=!1)=>{var r;if(!(!l||!l._id))try{S(!0);const i=await K.post(`${P}/api/v4/eval/test/submit/section`,{sectionId:l._id,submissionId:E._id,sectionType:"Quiz",quizAnswers:o,sectionLength:I.length,codingAnswers:null,autoSubmit:e});sessionStorage.removeItem(`solution-${g}-${h}`),M(n=>n+1),k(((r=i==null?void 0:i.data)==null?void 0:r.isSubmitted)||!1)}catch(i){console.error(i)}finally{f(!1),S(!1)}};return N||!l?s.jsx("div",{className:"h-screen flex justify-center items-center w-screen",children:s.jsx($,{})}):!m||m.length===0?s.jsx("div",{className:"h-screen flex justify-center items-center text-gray-600",children:"No questions found for this section."}):s.jsxs("main",{className:"flex bg-white flex-col lg:flex-row h-[calc(100vh-60px)]",children:[s.jsxs("section",{className:"flex-1 p-5 flex flex-col justify-between",children:[s.jsxs("div",{className:"border p-8 rounded-sm shadow-sm",children:[s.jsxs("p",{className:"mb-6 text-base",children:["Q",c+1,". ",t==null?void 0:t.question]}),(t==null?void 0:t.image)&&s.jsx("img",{className:"h-[260px] mb-4",src:t.image,alt:""}),s.jsxs("div",{className:"space-y-4",children:[((C=t==null?void 0:t.options)==null?void 0:C.length)>0?t.options.map((e,r)=>{var a;const i=t._id,n=j(t)?(a=o[i])==null?void 0:a.includes(e.text):o[i]===e.text;return s.jsxs("label",{className:`flex items-center p-3 border rounded-md cursor-pointer transition ${n?"border-blue-600 bg-blue-50":"border-gray-300"}`,children:[s.jsx("input",{type:j(t)?"checkbox":"radio",className:"mr-3",name:`question-${i}`,value:e.text,checked:n,onChange:()=>L(t,e.text)}),s.jsx("span",{children:e.text})]},r)}):s.jsx(W,{label:"Your Answer",fullWidth:!0,value:o[t==null?void 0:t._id]||"",onChange:e=>R(t==null?void 0:t._id,e.target.value)}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{onClick:()=>x(e=>{const r={...e};return delete r[t==null?void 0:t._id],r}),className:"text-sm text-gray-700",children:"Clear choice"})})]})]}),s.jsxs("div",{className:"mt-8 flex gap-4 justify-end",children:[s.jsx("button",{onClick:()=>u(e=>Math.max(e-1,0)),disabled:c===0,className:"px-4 py-2 rounded-md bg-[#1876d2] text-white text-sm disabled:opacity-50",children:"Previous"}),s.jsx("button",{onClick:()=>u(e=>Math.min(e+1,m.length-1)),disabled:c===m.length-1,className:"px-4 py-2 rounded-md bg-[#1876d2] text-white text-sm disabled:opacity-50",children:"Next"})]})]}),s.jsxs("section",{className:"lg:w-1/4 p-6 flex flex-col justify-between border-t gap-10 lg:border-t-0 lg:border-l border-gray-200",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-md font-semibold mb-4",children:"Question Navigator"}),s.jsx("div",{className:"grid grid-cols-6 gap-2 lg:grid-cols-5",children:m.map((e,r)=>s.jsx("button",{className:`${U(e._id)} h-[40px] w-[40px]`,onClick:()=>u(r),children:r+1},e._id))})]}),s.jsx(y,{fullWidth:!0,onClick:()=>f(!0),variant:"contained",color:"primary",children:"Submit"})]}),s.jsx(A,{open:z,onClose:()=>f(!1),children:s.jsxs("div",{style:{transform:"translate(-50%, -50%)"},className:"relative top-[50%] left-[50%] p-6 w-2/5 min-w-[40%] max-w-[40%] rounded-lg bg-white shadow-lg",children:[s.jsx("div",{className:"text-xl font-medium text-slate-800 pb-4",children:"Are you sure you want to submit?"}),s.jsxs("div",{className:"border-t border-slate-200 py-4 text-slate-600",children:["This action is ",s.jsx("span",{className:"font-semibold text-red-600",children:"irreversible"}),"."]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(y,{onClick:()=>f(!1),children:"Cancel"}),s.jsx(y,{variant:"contained",color:"success",onClick:()=>v(!1),children:"Confirm"})]})]})}),s.jsx(A,{open:B,children:s.jsx("div",{style:{transform:"translate(-50%, -50%)"},className:"relative top-[50%] left-[50%] p-6 w-2/5 rounded-lg bg-white shadow-lg flex justify-center items-center",children:s.jsx($,{})})})]})};export{ie as default};

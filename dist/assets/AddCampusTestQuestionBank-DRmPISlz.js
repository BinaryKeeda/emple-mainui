import{r,j as t,ad as q,a0 as F,b as C,B as w}from"./index-DuMHTSdw.js";import{B as P}from"./Box-PH6FcrNI.js";import{T as $}from"./Typography-6eP7TF88.js";import{S as A}from"./Stack-X4TEWH5P.js";import{T as B}from"./TextField-DS3DH8Ob.js";import{M as k}from"./MenuItem-DnBDY4tK.js";import{a as W}from"./Menu-DhppiPkq.js";import{L as H,a as L}from"./ListItemText-B9drsZyE.js";import{B as O}from"./Button-CjMKz1A8.js";import"./extendSxProp-d_nzIvff.js";import"./index-DGHOctzD.js";import"./useThemeProps-BUS0qFC5.js";import"./Select-ulCrDANk.js";import"./Grow-BjJ8mM2A.js";import"./dividerClasses-Uen8-N24.js";import"./index-CRzeOzbS.js";import"./Paper-tsmsi79X.js";import"./mergeSlotProps-CFfg8Mmd.js";const Q={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:800,maxHeight:"80vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"},U=["Core","Misclleneaous","Aptitude"];function me({open:l=!0,onSuccess:M,onClose:x,testId:I,sectionId:E}){const[c,d]=r.useState([]),[Y,m]=r.useState(1),[o,g]=r.useState(!1),[u,i]=r.useState(!0),[h,b]=r.useState(""),[f,y]=r.useState(""),n=r.useRef(),R=r.useCallback(e=>{o||(n.current&&n.current.disconnect(),n.current=new IntersectionObserver(s=>{s[0].isIntersecting&&u&&m(a=>a+1)}),e&&n.current.observe(e))},[o,u]),T=async(e,s=!1)=>{g(!0);try{const j=(await C.get(`${w}/api/admin/questionbanks?search=${h}&category=${f}&page=${e}&limit=10&sortBy=createdAt&sortOrder=desc`,{withCredentials:!0})).data.data||[];d(S=>{const N=new Set(S.map(p=>p._id)),v=j.filter(p=>!N.has(p._id));return s?v:[...S,...v]}),i(j.length>0)}catch(a){console.error("Error fetching problems:",a),i(!1)}finally{g(!1)}};r.useEffect(()=>{l&&(d([]),m(1),i(!0),T(1,!0))},[h,f,l]);const _=async e=>{try{await C.put(`${w}/api/admin/campus/tests/${I}/sections/${E}/question-bank`,{questionBankId:e},{withCredentials:!0}),alert("Problem added successfully!"),M(),x()}catch(s){console.error("Failed to add problem:",s),alert("Failed to add problem")}},z=()=>{d([]),m(1),i(!0),b(""),y(""),x()};return t.jsx(q,{open:l,onClose:z,children:t.jsxs(P,{sx:Q,children:[t.jsx($,{variant:"h6",mb:2,children:"Select QuestionBank to Add"}),t.jsxs(A,{direction:{xs:"column",sm:"row"},spacing:2,mb:2,children:[t.jsx(B,{size:"small",label:"Search",value:h,onChange:e=>b(e.target.value),fullWidth:!0}),t.jsxs(B,{select:!0,size:"small",label:"Category",value:f,onChange:e=>y(e.target.value),fullWidth:!0,children:[t.jsx(k,{value:"",children:"All"}),U.map(e=>t.jsx(k,{value:e,children:e},e))]})]}),t.jsx(W,{children:c.map((e,s)=>{const a=c.length===s+1;return t.jsx(H,{ref:a?R:null,divider:!0,secondaryAction:t.jsx(O,{size:"small",variant:"contained",onClick:()=>_(e._id),children:"Add"}),children:t.jsxs(A,{children:[t.jsx(L,{primary:e.name,secondary:`Category: ${e.category}`}),t.jsx(L,{primary:"No of Questions",secondary:`${e.questionsCount}`})]})},e._id)})}),o&&t.jsx(P,{className:"flex justify-center mt-4",children:t.jsx(F,{size:24})}),!o&&!u&&c.length===0&&t.jsx($,{className:"text-center mt-4",color:"textSecondary",children:"No problems found."})]})})}export{me as default};

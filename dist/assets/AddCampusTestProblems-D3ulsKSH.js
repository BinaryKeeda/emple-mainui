import{r as s,j as t,K as N,aa as F,d as w,B as v}from"./index-Bxv2XW7s.js";import{B as x}from"./Box-BDgMu6r9.js";import{T as A}from"./Typography-Sdjam6FC.js";import{T as I}from"./TextField-CRoMzUQG.js";import{a as z}from"./Menu-BMSMKbrI.js";import{L as H,a as O}from"./ListItemText-BBlNzjER.js";import{C as W}from"./Checkbox-CsaFXXKH.js";import{B as D}from"./Button-DPvpB8e1.js";import"./extendSxProp-C_WbeLBK.js";import"./index-Db-RTOgX.js";import"./Select-BbkB2KbL.js";import"./Grow-DXWY8T7w.js";import"./index-CcTEQCDj.js";import"./Paper-_aUgwZNt.js";import"./mergeSlotProps-BLM4XvOO.js";import"./MenuItem-XWZZA_H6.js";import"./dividerClasses-lMDni_aD.js";import"./SwitchBase-ClHuPBfZ.js";const K={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:800,maxHeight:"80vh",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,overflowY:"auto"};function ce({open:o,onSuccess:B,onClose:L,testId:$,sectionId:E}){const[d,m]=s.useState([]),[i,b]=s.useState([]),[g,u]=s.useState(1),[l,y]=s.useState(!1),[f,n]=s.useState(!0),[h,j]=s.useState(""),c=s.useRef(),_=s.useCallback(e=>{l||(c.current&&c.current.disconnect(),c.current=new IntersectionObserver(r=>{r[0].isIntersecting&&f&&u(a=>a+1)}),e&&c.current.observe(e))},[l,f]),S=async(e,r=!1)=>{y(!0);try{const p=(await w.get(`${v}/api/admin/problems?search=${h}&page=${e}&limit=10&sortBy=createdAt&sortOrder=desc`,{withCredentials:!0})).data.data||[];m(C=>r?p:[...C,...p.filter(T=>!C.some(M=>M._id===T._id))]),n(p.length>0)}catch(a){console.error("Error fetching problems:",a),n(!1)}finally{y(!1)}};s.useEffect(()=>{o&&S(g)},[g,o]),s.useEffect(()=>{o&&(m([]),u(1),n(!0),S(1,!0))},[h,o]);const k=e=>{b(r=>r.includes(e)?r.filter(a=>a!==e):[...r,e])},R=async()=>{if(i.length===0){alert("Please select at least one problem.");return}try{await w.put(`${v}/api/admin/campus/tests/${$}/sections/${E}/problems`,{problemIds:i},{withCredentials:!0}),alert("Problems added successfully!"),B(),P()}catch(e){console.error("Failed to add problems:",e),alert("Failed to add problems")}},P=()=>{m([]),b([]),u(1),n(!0),j(""),L()};return t.jsx(N,{open:o,onClose:P,children:t.jsxs(x,{sx:K,children:[t.jsx(A,{variant:"h6",mb:2,children:"Select Problems to Add"}),t.jsx(I,{size:"small",label:"Search problems",value:h,onChange:e=>j(e.target.value),fullWidth:!0,sx:{mb:2}}),t.jsx(z,{children:d.map((e,r)=>{const a=d.length===r+1;return t.jsx(H,{ref:a?_:null,divider:!0,secondaryAction:t.jsx(W,{edge:"end",checked:i.includes(e._id),onChange:()=>k(e._id)}),children:t.jsx(O,{primary:e.title,secondary:`Difficulty: ${e.difficulty}`})},e._id)})}),l&&t.jsx(x,{className:"flex justify-center mt-4",children:t.jsx(F,{size:24})}),!l&&!f&&d.length===0&&t.jsx(A,{className:"text-center mt-4",color:"textSecondary",children:"No problems found."}),t.jsx(x,{mt:2,className:"flex justify-end",children:t.jsxs(D,{variant:"contained",onClick:R,disabled:i.length===0,children:["Add Selected (",i.length,")"]})})]})})}export{ce as default};
